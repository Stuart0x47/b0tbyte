[ { "title": "FoggyWeb", "url": "/posts/foggyweb/", "categories": "malware, backdoor", "tags": "foggyweb", "date": "2022-02-27 00:00:00 +0000", "snippet": " creator: NOBELIUM type: post-exploitation backdoor references: https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/sysmon_foggyweb_nobelium.yml https://www.microsoft.com/security/blog/2021/09/27/foggyweb-targeted-nobelium-malware-leads-to-persistent-backdoor/ FoggyWeb is used to remotely exfiltrate the configuration database of compromised AD FS servers, decrypted token-signing certificate, and token-decryption certificate, as well as to download and execute additional components FoggyWeb is stored in the encrypted file Windows.Data.TimeZones.zh-PH.pri, while the malicious file version.dll can be described as its loader. loader is responsible for loading the encrypted FoggyWeb backdoor file and utilizing a custom Lightweight Encryption Algorithm (LEA) routine to decrypt the backdoor in memory.Process After compromising an AD FS server, NOBELIUM was observed dropping the following two files on the system (administrative privileges are required to write these files to the folders listed below): %WinDir%\\ADFS\\version.dll %WinDir%\\SystemResources\\Windows.Data.TimeZones\\pris\\Windows.Data.TimeZones.zh-PH.pri Once the system or the AD FS service is restarted, Microsoft.IdentityServer.ServiceHost.exe loads mscoree.dll, which in turn loads mscoreei.dll. mscoreei.dll has a delay load import (Delay Import) named version.dll. Once loaded, instead of loading the legitimate version.dll from the %WinDir%\\System32\\ folder mscoreei.dll loads the malicious version.dll planted by the attacker in %WinDir%\\ADFS\\ folder (referred to as DLL search order hijacking),Post-Compromise FoggyWeb setups up HTTP listeners (C2) GET endpoints /adfs/portal/images/theme/light01/profile.webp /adfs/portal/images/theme/light01/background.webp /adfs/portal/images/theme/light01/logo.webp POST endpoint /adfs/services/trust/2005/samlmixed/upload SIEMWindows Sysmon :: ImageLoad:”C:\\Windows\\ADFS\\version.dll” AND event_id:7IDSalert http $EXTERNAL_NET any -&amp;gt; $HOME_NET any (msg:&quot;NOBELIUM FoggyWeb C2 HTTP Listeners&quot;; flow:established, to_server; http.method; content:&quot;GET&quot;; http.uri; content:&quot;/adfs/portal/images/theme/light01/&quot;; content:&quot;.webp&quot;; endswith; tag:session,5,packets; reference:url, www.microsoft.com/security/blog/2021/09/27/foggyweb-targeted-nobelium-malware-leads-to-persistent-backdoor/; classtype:command-and-control; sid:900442; rev:1; metadata: created_at 2021-09-28, updated_at 2021-09-28, mitre_tactic_id TA0011, mitre_tactic_name Command_and_Control, mitre_technique_id T1071, mitre_technique_name Application_Layer_Protocol;)alert http $EXTERNAL_NET any -&amp;gt; $HOME_NET any (msg:&quot;NOBELIUM FoggyWeb C2 HTTP Listener&quot;; flow:established, to_server; http.method; content:&quot;POST&quot;; http.uri; content:&quot;/adfs/services/trust/2005/samlmixed/upload&quot;; tag:session,5,packets; reference:url, www.microsoft.com/security/blog/2021/09/27/foggyweb-targeted-nobelium-malware-leads-to-persistent-backdoor/; classtype:command-and-control; sid:900443; rev:1; metadata: created_at 2021-09-28, updated_at 2021-09-28, mitre_tactic_id TA0011, mitre_tactic_name Command_and_Control, mitre_technique_id T1071, mitre_technique_name Application_Layer_Protocol;)" }, { "title": "Colibri", "url": "/posts/Colibri/", "categories": "malware, loader", "tags": "colibri", "date": "2022-02-27 00:00:00 +0000", "snippet": "Colibri was first reported in August 14 2021 in a tweet by @ViriBack on twitter.The loader is comes with a server build for managing multiple infections. The report included a link to any.run for the panel the loader reaches out to. Samples of the loader were uploaded to malware repositories.The current scope for detection has been classifying the samples as Kovter related.schtasks.exe /create /tn COMSurrogate /st 00:00 /du 9999:59 /sc once /ri 1 /f /tr &quot;C:\\Users\\admin\\Documents\\WindowsPowerShell\\dllhost.exe&quot;Panelhttps://app.any.run/tasks/3ce8f724-68ad-464a-a9ca-19070f30f2d0/ Url IP FirstSeen 54.38.123.239/panel/login.php 54.38.123.239 21-09-2021 teledata.top/panel/login.php 46.17.47.110 11-09-2021 193.56.146.67/panel/login.php 193.56.146.67 01-09-2021 80.92.205.102/panel/login.php 80.92.205.102 21-08-2021 94.103.80.169/panel/login.php 94.103.80.169 14-08-2021 Samples0e78df69265dc57c37673bdee540ce2fhttp://94.103.80.169/gate.php?type=check&amp;amp;uid=1BAC485F155F1598512967http://94.103.80.169/gate.php?type=update&amp;amp;uid=1BAC485F155F1598512967http://94.103.80.169/gate.php?type=ping&amp;amp;uid=1BAC485F155F1598512967d484d8f8dd80ed5bf5405476592bc798http://teledata.top/gate.php?type=check&amp;amp;uid=1BAC485F155F1598512967a56fea310f3cf5e724ee4a9990047b78http://80.92.205.102/gate.php?type=check&amp;amp;uid=1BAC485F155F1598512967 /gate.php?type=(check update ping report ip settings loader) SIEMWindows Sysmon :: Image:”schtask.exe” AND CommandLine:(“COMSurrogate” AND “WindowsPowerShell\\dllhost.exe”)IDSalert http $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;[Connectwise CRU] Colibri Loader Activity&quot;; flow:established,to_server; http.method; content:&quot;GET&quot;; http.uri; content:&quot;.php?type=ping&amp;amp;uid=&quot;; fast_pattern; pcre:&quot;/^[0-9A-F]{16,32}$/Rs&quot;; http.user_agent;content:!&quot;Mozilla&quot;; content:!&quot;Safari&quot;; content:!&quot;Opera&quot;; pcre:&quot;/^[A-Za-z0-9]{16,32}$/&quot;; http.header_names; content:&quot;|0d 0a|User-Agent|0d 0a|Host|0d 0a 0d 0a|&quot;; bsize:22; content:!&quot;Referer&quot;; classtype:command-and-control; sid:900462; rev:1; metadata: created_at 2021_10_27, updated_at 2021_10_27, mitre_tactic_id TA0011, mitre_tactic_name Command_and_Control, mitre_technique_id T1071, mitre_technique_name Application_Layer_Protocol;)alert http $EXTERNAL_NET any -&amp;gt; $HOME_NET any (msg:&quot;Colibri Loader C2 HTTP Fingerprint&quot;; flow:established, to_client; http.response_body; content:&quot;|a9| 2021 Colibri Loader&quot;; fast_pattern; tag:session,5,packets; classtype:trojan-activity; sid:900461; rev:1; metadata: created_at 2021_10_27, updated_at 2021_10_27, mitre_tactic_id TA0011, mitre_tactic_name Command_and_Control, mitre_technique_id T1071, mitre_technique_name Application_Layer_Protocol;)" }, { "title": "BluStealer", "url": "/posts/BluStealer/", "categories": "malware, stealer", "tags": "blustealer", "date": "2022-02-27 00:00:00 +0000", "snippet": " creator: unknown type: stealer, keylogger references: https://www.gosecure.net/blog/2021/09/22/gosecure-titan-labs-technical-report-blustealer-malware-threat/ https://decoded.avast.io/anhho/blustealer/ Components ChromeRecovery.exe gathers system information, such as the computer name, username, Windows version, antivirus solution, CPU name, GPU name, the amount of RAM, internal IP, and external IP writes to C:\\Users&amp;lt;username&amp;gt;\\AppData\\Roaming\\Microsoft\\Windows\\Templates\\credentials.txt ConsoleApp8.exe (found in ChromeRecovery.exe) saved, executed, and deleted from the Templates directory steals credentials from Windows Vault and WinSCP and appends them to credentials.txt ThunderFox.exe targets Mozilla products: ThunderBird, FireFox, Waterfox, K-Meleon, IceDragon, Cyberfox, BlackHawK, Pale Moon extracts login credentials from logins.json, key4.db, signons.sqlite, and key3.db. logins.json stores encrypted passwords for Mozilla products (legacy versions) dumps to credentials.txt Keylogging polls user32.getAsyncKeyState, which determines whether a key is pressed or not at the time of the call Crypto wallet stealing Searches for crypto directories: Zcash, Armory, Bytecoin, Jaxx Liberty, Exodus, Ethereum, Electrum, Guarda, and Coinomi Exfil / C2 telegram and discord https[:]//api.telegram.org/bot[BOT TOKEN]/sendMessage?chat_id=[MY_CHANNEL_ID]&amp;amp;text=[MY_MESSAGE_TEXT] https[:]//api.telegram.org/bot[BOT TOKEN]/sendDocument?chat_id=[MY_CHANNEL_ID]&amp;amp;caption=[MY_CAPTION] SMTP written in MimeOLE format contains credentials.txt and other stolen information SIEMWindows Sysmon :: Target_Filename: “AppData\\Roaming\\Microsoft\\Windows\\Templates\\credentials.txt”IDSalert smtp $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;BluStealer SMTP Exfiltration&quot;; flow:established, to_server; content:&quot;Subject|3a 20|Passwords|3a 3a 3a 3a|&quot;; nocase; fast_pattern; content:&quot;X-MimeOLE|3a 20|&quot;; tag:session,5,packets; reference:url, decoded.avast.io/anhho/blustealer/; classtype:trojan-activity; sid:900442; rev:1; metadata: created_at 2021-09-28, updated_at 2021-09-28, mitre_tactic_id TA0010, mitre_tactic_name Exfiltration, mitre_technique_id T1567, mitre_technique_name Exfiltration_Over_Web_Service;)alert http $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;Telegram GET SendMessage Activity&quot;; flow:established,to_server; http.method; content:&quot;GET&quot;; http.uri; content:&quot;/bot&quot;; depth:4; content:&quot;/sendMessage?chat_id=&quot;; distance:0; http.host; content:&quot;api.telegram.org&quot;; tag:session,5,packets; classtype:command-and-control; sid:900436; rev:1; metadata: created_at 2021-09-24, updated_at 2021-09-24;)alert http $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;Telegram POST SendMessage Activity&quot;; flow:established,to_server; http.method; content:&quot;POST&quot;; http.uri; content:&quot;/bot&quot;; startswith; content:&quot;/sendMessage&quot;; distance:0; http.host; content:&quot;api.telegram.org&quot;; http.request_body; content:&quot;chat_id=&quot;; tag:session,5,packets; classtype:command-and-control; sid:900437; rev:1; metadata: created_at 2021-09-24, updated_at 2021-09-24;)alert http $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;Telegram SendDocument Activity&quot;; flow:established,to_server; http.method; content:&quot;POST&quot;; http.uri; content:&quot;/bot&quot;; content:&quot;/sendDocument?chat_id=&quot;; distance:0; http.host; content:&quot;api.telegram.org&quot;; classtype:command-and-control; tag:session,5,packets; sid:900438; rev:1; metadata: created_at 2021-09-24, updated_at 2021-09-24;)alert http $HOME_NET any -&amp;gt; $EXTERNAL_NET any (msg:&quot;[ConnectWise CRU] Telegram getMe Activity&quot;; flow:established,to_server; http.method; content:&quot;GET&quot;; http.uri; content:&quot;/bot&quot;; depth:4; content:&quot;/getMe&quot;; isdataat:!2,relative; pcre:&quot;/^\\/bot\\d+\\:[A-Za-z0-9\\-]+\\/getMe\\??$/&quot;; http.host; content:&quot;api.telegram.org&quot;; tag:session,5,packets; classtype:command-and-control; sid:900439; rev:1; metadata: created_at 2021-09-24, updated_at 2021-09-24;)" } ]
